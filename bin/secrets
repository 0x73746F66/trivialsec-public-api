#!/usr/bin/env bash
set -e

readonly default_namespace=$(id -nu)-$(cat /etc/hostname)
if [ -f .env ]; then
    source .env
fi
APP_NAME=${APP_NAME:-default_namespace}
read -p "What is your namespace (set via APP_NAME)? [${APP_NAME}]: " namespace
namespace=${namespace:-${APP_NAME}}

function prompt() {
    local param_name=$1
    local default_value=${2:-""}
    local type=${3:-SecureString}
    local user_value

    read -p "${param_name} [${default_value}]: " user_value
    user_value=${user_value:-${default_value}}
    [ -z "${user_value}" ] && ( echo "empty input, skipping.."; return; )
    aws ssm put-parameter \
        --name "/Dev/Deploy/${namespace}/${param_name}" \
        --type "${type}" \
        --value "${user_value}" \
        --overwrite
}

prompt "recaptcha_site_key" "${TF_VAR_recaptcha_site_key}" "String"
prompt "stripe_publishable_key" "${TF_VAR_stripe_publishable_key}" "String"
prompt "phishtank_username" "${TF_VAR_phishtank_username}" "String"
prompt "mysql_password" "${TF_VAR_mysql_password}"
prompt "session_secret_key" "${TF_VAR_session_secret_key}"
prompt "recaptcha_secret_key" "${TF_VAR_recaptcha_secret_key}"
prompt "sendgrid_api_key" "${TF_VAR_sendgrid_api_key}"
prompt "stripe_secret_key" "${TF_VAR_stripe_secret_key}"
prompt "stripe_webhook_secret" "${TF_VAR_stripe_webhook_secret}"
prompt "google_api_key" "${TF_VAR_google_api_key}"
prompt "phishtank_key" "${TF_VAR_phishtank_key}"
prompt "honeyscore_key" "${TF_VAR_honeyscore_key}"
prompt "projecthoneypot_key" "${TF_VAR_projecthoneypot_key}"
prompt "whoisxmlapi_key" "${TF_VAR_whoisxmlapi_key}"
